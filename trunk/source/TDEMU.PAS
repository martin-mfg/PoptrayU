unit TDEMU;
{**************************************************************************}
{                                                                          }
{    This C DLL header file first (automatic) conversion generated by:     }
{    HeadConv 4.0 (c) 2000 by Bob Swart (aka Dr.Bob - www.drbob42.com)     }
{      Final Delphi-Jedi (Darth) command-line units edition                }
{                                                                          }
{    Generated Date: 10/23/2015                                            }
{    Generated Time: 12:33:31 PM                                              }
{                                                                          }
{**************************************************************************}

interface
uses
{$IFDEF WIN32}
  Windows;
{$ELSE}
  Wintypes, WinProcs;
{$ENDIF}


{=> tdemu-1.10\TDEMU.H <=}

{+// }
{-Task Dialog Emulation Library }
{-Copyright © 2008-2009 KoroSoft }

{-You may use and redistribute this library free of charge, as long as you }
{-redistribute the unmodified DLL. If the software is not free or commercial, }
{-the About box must contain the following text: }

{-"This software uses user interface code by KoroSoft." }
{= }

{$IFNDEF _TDEMU_H_}
{$DEFINE _TDEMU_H_}

{$IFDEF TDEMU_EXPORTS}
const
  TDEMUAPI = __stdcall;
{$ELSE}
const
  TDEMUAPI = __declspec(dllimport) __stdcall;
{$ENDIF}

{$IFDEF __cplusplus}
{$ENDIF}

{+// }
{-Real emulated APIs }
{= }

var
  TaskDialogEmulate: function(hWndParent: HWND; 
                              hInstance: HINSTANCE; 
                              var pszWindowTitle: CWSTR; 
                              var pszMainInstruction: CWSTR; 
                              var pszContent: CWSTR; 
                              dwCommonButtons: TASKDIALOG_COMMON_BUTTON_FLAGS; 
                              var pszIcon: CWSTR; 
                              var pnButton: Integer): HRESULT cdecl  {$IFDEF WIN32} stdcall {$ENDIF}; 

var
  TaskDialogIndirectEmulate: function(const pTaskConfig: PTASKDIALOGCONFIG; 
                                      var pnButton: Integer; 
                                      var pnRadioButton: Integer; 
                                      var pfVerificationFlagChecked: Bool): HRESULT cdecl  {$IFDEF WIN32} stdcall {$ENDIF}; 

{+// }
{-Control APIs }
{= }

var
  TaskDialogSetEmulation: function(bAlwaysEmulate: Bool): HRESULT cdecl  {$IFDEF WIN32} stdcall {$ENDIF}; 

{$IFDEF __cplusplus}
{$ENDIF}

{$ENDIF // _TDEMU_H_}

var
  DLLLoaded: Boolean { is DLL (dynamically) loaded already? }
    {$IFDEF WIN32} = False; {$ENDIF}

implementation

var
  SaveExit: pointer;
  DLLHandle: THandle;
{$IFNDEF MSDOS}
  ErrorMode: Integer;
{$ENDIF}

  procedure NewExit; far;
  begin
    ExitProc := SaveExit;
    FreeLibrary(DLLHandle)
  end {NewExit};

procedure LoadDLL;
begin
  if DLLLoaded then Exit;
{$IFNDEF MSDOS}
  ErrorMode := SetErrorMode($8000{SEM_NoOpenFileErrorBox});
{$ENDIF}
  DLLHandle := LoadLibrary('TDEMU.DLL');
  if DLLHandle >= 32 then
  begin
    DLLLoaded := True;
    SaveExit := ExitProc;
    ExitProc := @NewExit;
    @TaskDialogEmulate := GetProcAddress(DLLHandle,'TaskDialogEmulate');
  {$IFDEF WIN32}
    Assert(@TaskDialogEmulate <> nil);
  {$ENDIF}
    @TaskDialogIndirectEmulate := GetProcAddress(DLLHandle,'TaskDialogIndirectEmulate');
  {$IFDEF WIN32}
    Assert(@TaskDialogIndirectEmulate <> nil);
  {$ENDIF}
    @TaskDialogSetEmulation := GetProcAddress(DLLHandle,'TaskDialogSetEmulation');
  {$IFDEF WIN32}
    Assert(@TaskDialogSetEmulation <> nil);
  {$ENDIF}
  end
  else
  begin
    DLLLoaded := False;
    { Error: TDEMU.DLL could not be loaded !! }
  end;
{$IFNDEF MSDOS}
  SetErrorMode(ErrorMode)
{$ENDIF}
end {LoadDLL};

begin
  LoadDLL;
end.
